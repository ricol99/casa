{
   "casa": {
      "uName": "casa:test-combinestateproperty",
      "displayName": "Casa Collin Test State Property",
      "gang": "gang:collin-test",
      "listeningPort": 8085
   },
   "services": [],
   "scenes": [],
   "things": [
      {
         "uName": "tester:combinestateproperty",
         "displayName": "Test property:combinestateproperty",
         "props": [],
         "targetUnderTest": "testthing:test-thing",
         "sources": [
            { "property": "test-state-1" },
            { "property": "test-state-2" },
            { "property": "test-combined-state" },
            { "event": "made-it-test-state-1-idle" },
            { "event": "made-it-default-state" }
         ],
         "testRun": {
            "preAmble": {
               "expectedSequence": [
                  { "simultaneous": [
                     { "property": "test-combined-state", "value": "undefined:test-state-2-idle" },
                     { "event": "made-it-default-state", "value": true }
                  ]},
                  { "simultaneous": [
                     { "property": "test-combined-state", "value": "test-state-1-idle:test-state-2-idle" },
                     { "event": "made-it-test-state-1-idle", "value": true }
                  ]}
               ]
            },
            "testCases": [1]
         },
         "testCases": [
            {
               "name": "1) Normal - Test basic transition on event and timeout based transition ",
               "driveSequence": [
                  { "event": "start-test-1" },
                  { "wait": 1, "event": "start-test-2" }
               ],
               "expectedSequence": [
                  { "simultaneous": [
                     { "property": "test-state-1", "value": "test-state-1-started" },
                     { "property": "test-combined-state", "value": "test-state-1-started:test-state-2-idle" },
                     { "event": "made-it-default-state", "value": true }
                  ]},
                  { "simultaneous": [
                     { "property": "test-state-2", "value": "test-state-2-started" },
                     { "property": "test-combined-state", "value": "test-state-1-started:test-state-2-started" },
                     { "event": "made-it-default-state", "value": true }
                  ]},
                  { "simultaneous": [
                     { "property": "test-state-1", "value": "test-state-1-timed-out" },
                     { "property": "test-combined-state", "value": "test-state-1-timed-out:test-state-2-started" },
                     { "event": "made-it-default-state", "value": true }
                  ]},
                  { "simultaneous": [
                     { "property": "test-state-1", "value": "test-state-1-idle" },
                     { "property": "test-combined-state", "value": "test-state-1-idle:test-state-2-started" },
                     { "event": "made-it-test-state-1-idle", "value": true }
                  ]},
                  { "simultaneous": [
                     { "property": "test-state-2", "value": "test-state-2-timed-out" },
                     { "property": "test-combined-state", "value": "test-state-1-idle:test-state-2-timed-out" },
                     { "event": "made-it-test-state-1-idle", "value": true }
                  ]},
                  { "simultaneous": [
                     { "property": "test-state-2", "value": "test-state-2-idle" },
                     { "property": "test-combined-state", "value": "test-state-1-idle:test-state-2-idle" },
                     { "event": "made-it-test-state-1-idle", "value": true }
                  ]}
               ]
            }
         ],
         "things": [
         ]
      },
      {
         "uName": "testthing:test-thing",
         "displayName": "Test thing",
         "events": [],
         "props": [
            {
               "name": "test-state-1",
               "type": "stateproperty",
               "initialValue": "test-state-1-idle",
               "states": [
                  {
                     "name": "test-state-1-idle",
                     "sources": [{ "event": "start-test-1", "nextState": "test-state-1-started" }]
                  },
                  {
                     "name": "test-state-1-started",
                     "timeout": { "duration": 2, "nextState": "test-state-1-timed-out" },
                     "sources": [{ "event": "jump-to-test-state-1-main", "nextState": "test-state-1-main" }]
                  },
                  {
                     "name": "test-state-1-timed-out",
                     "timeout": { "duration": 2, "nextState": "test-state-1-idle" },
                     "sources": [{ "event": "reset-back-to-idle", "nextState": "test-state-1-idle" }]
                  },
                  {
                     "name": "test-state-1-main",
                     "timeout": { "duration": 2, "nextState": "test-state-1-idle" }
                  }
               ]
            },
            {
               "name": "test-state-2",
               "type": "stateproperty",
               "initialValue": "test-state-2-idle",
               "states": [
                  {
                     "name": "test-state-2-idle",
                     "sources": [{ "event": "start-test-2", "nextState": "test-state-2-started" }]
                  },
                  {
                     "name": "test-state-2-started",
                     "timeout": { "duration": 4, "nextState": "test-state-2-timed-out" },
                     "sources": [{ "event": "jump-to-test-state-2-main", "nextState": "test-state-2-main" }]
                  },
                  {
                     "name": "test-state-2-timed-out",
                     "timeout": { "duration": 4, "nextState": "test-state-2-idle" },
                     "sources": [{ "event": "reset-back-to-idle", "nextState": "test-state-2-idle" }]
                  },
                  {
                     "name": "test-state-2-main",
                     "timeout": { "duration": 4, "nextState": "test-state-2-idle" }
                  }
               ]
            },
            {  
               "name": "test-combined-state",
               "type": "combinestateproperty",
               "separator": ":",
               "sources": [
                  {
                     "property": "test-state-1"
                  },
                  {
                     "property": "test-state-2"
                  }
               ],
               "states": [
                  {  
                     "name": "test-state-1-idle-state-test-state-2-idle"
                  },
                  {
                     "name": "test-state-1-idle",
                     "regEx": "test-state-1-idle:",
                     "action": { "event": "made-it-test-state-1-idle", "value": true }
                  },
                  {
                     "name": "DEFAULT",
                     "action": { "event": "made-it-default-state", "value": true }
                  }
               ]
            }
         ],
         "things": []
      }
   ]
}
