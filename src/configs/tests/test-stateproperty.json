{
   "casa": {
      "uName": "casa:test-stateproperty",
      "displayName": "Casa Collin Test State Property",
      "gang": "gang:collin-test",
      "listeningPort": 8085
   },
   "services": [],
   "scenes": [],
   "things": [
      {
         "uName": "tester:stateproperty",
         "displayName": "Test property:stateproperty",
         "sources": [
            { "uName": "testthing:test-thing", "property": "test-state-1" },
            { "uName": "testthing:test-thing", "property": "test-target-guard-prop" },
            { "uName": "testthing:test-thing", "property": "test-prop-3" },
            { "uName": "testthing:test-thing", "event": "test-target-function-event" }
         ],
         "testCases": [
            {
               "name": "1) Normal - Test basic transition on event and timeout based transition ",
               "driveSequence": [
                  { "wait": 3, "event": "start-test" },
                  { "wait": 6, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-started" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-timed-out-state" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {
               "name": "2) Normal - Test basic transition on event and timeout based transition with intermediate inherited timer ",
               "driveSequence": [
                  { "wait": 2, "event": "start-test" },
                  { "wait": 3, "event": "jump-to-timer-inherited-state" },
                  { "wait": 3, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-started" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-timer-inherited-state" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-timed-out-state" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {
               "name": "3) Normal - Test basic transition on event and timeout based transition with intermediate non-inherited timer ",
               "driveSequence": [
                  { "wait": 2, "event": "start-test" },
                  { "wait": 3, "event": "jump-to-timer-non-inherited-state" },
                  { "wait": 6, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-started" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-timer-non-inherited-state" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-timed-out-state" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {
               "name": "4) Normal - Test basic transition with guard on source",
               "driveSequence": [
                  { "wait": 2, "event": "start-test" },
                  { "wait": 3, "event": "jump-to-guarded-source-state" },
                  { "wait": 1, "event": "go-through-source-guard" },
                  { "wait": 3, "property": "test-source-guard-prop", "value": true },
                  { "wait": 3, "property": "test-source-guard-prop", "value": false },
                  { "wait": 1, "property": "test-prop-3", "value": false },
                  { "wait": 1, "event": "back-to-test-guarded-source-state" },
                  { "wait": 1, "property": "test-target-guard-prop", "value": true },
                  { "wait": 1, "event": "go-through-source-guard" },
                  { "wait": 1, "property": "test-target-guard-prop", "value": false },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-started" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-guarded-source-state" },
                  { "source": "testthing:test-thing", "property": "test-prop-3", "value": true },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-guarded-target-state" },
                  { "source": "testthing:test-thing", "property": "test-prop-3", "value": false },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-guarded-source-state" },
                  { "source": "testthing:test-thing", "property": "test-target-guard-prop", "value": true },
                  { "source": "testthing:test-thing", "property": "test-target-guard-prop", "value": false },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {
               "name": "5) Normal - Test basic transition with active guard on target",
               "driveSequence": [
                  { "wait": 2, "event": "start-test" },
                  { "wait": 3, "event": "jump-to-non-active-guarded-source-state" },
                  { "wait": 1, "event": "go-through-source-guard" },
                  { "wait": 3, "property": "test-source-guard-prop", "value": true },
                  { "wait": 2, "event": "go-through-source-guard" },
                  { "wait": 1, "property": "test-target-guard-prop", "value": false },
                  { "wait": 3, "property": "test-source-guard-prop", "value": false },
                  { "wait": 1, "property": "test-target-guard-prop", "value": true },
                  { "wait": 1, "property": "test-target-guard-prop", "value": false },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-started" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-non-active-guarded-source-state" },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-guarded-target-state" },
                  { "source": "testthing:test-thing", "property": "test-target-guard-prop", "value": true },
                  { "source": "testthing:test-thing", "property": "test-prop-3", "value": true },
                  { "source": "testthing:test-thing", "property": "test-target-guard-prop", "value": false },
                  { "source": "testthing:test-thing", "property": "test-prop-3", "value": false },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {  
               "name": "6) Normal - Test basic transition with non-active guard on source",
               "driveSequence": [
                  { "wait": 2, "event": "start-test" },
                  { "wait": 1, "property": "test-target-guard-prop", "value": true },
                  { "wait": 1, "event": "jump-to-guarded-target-state" },
                  { "wait": 1, "property": "test-target-guard-prop", "value": false },
                  { "wait": 1, "property": "test-prop-3", "value": false },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-started" },
                  { "source": "testthing:test-thing", "property": "test-target-guard-prop", "value": true },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-guarded-target-state" },
                  { "source": "testthing:test-thing", "property": "test-target-guard-prop", "value": false },
                  { "source": "testthing:test-thing", "property": "test-prop-3", "value": true },
                  { "source": "testthing:test-thing", "property": "test-prop-3", "value": false },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {  
               "name": "7) Normal - Test target function",
               "driveSequence": [
                  { "wait": 2, "event": "start-test" },
                  { "wait": 1, "event": "jump-to-target-function-state" },
                  { "wait": 1, "property": "test-prop-3", "value": false },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-started" },
                  { "source": "testthing:test-thing", "property": "test-prop-3", "value": true, "fuzz": 1 },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-target-function-state" },
                  { "source": "testthing:test-thing", "event": "test-target-function-event", "value": true },
                  { "source": "testthing:test-thing", "property": "test-prop-3", "value": false },
                  { "source": "testthing:test-thing", "property": "test-state-1", "value": "test-idle-state" }
               ]
            }
         ],
         "props": [],
         "things": [
            {
               "uName": "testthing:test-thing",
               "displayName": "Test thing",
               "events": [],
               "props": [
                  {
                     "name": "test-prop-1",
                     "initialValue": false
                  },
                  {
                     "name": "test-prop-2",
                     "initialValue": false
                  },
                  {
                     "name": "test-prop-3",
                     "initialValue": false
                  },
                  {
                     "name": "test-source-guard-prop",
                     "initialValue": false
                  },
                  {
                     "name": "test-target-guard-prop",
                     "initialValue": false
                  },
                  {
                     "name": "test-state-1",
                     "type": "stateproperty",
                     "initialValue": "test-idle-state",
                     "states": [
                        {
                           "name": "test-idle-state",
                           "sources": [{ "event": "start-test", "nextState": "test-started" }]
                        },
                        {
                           "name": "test-started",
                           "timeout": { "duration": 5, "nextState": "test-timed-out-state" },
                           "sources": [{ "event": "jump-to-timer-inherited-state", "nextState": "test-timer-inherited-state" },
                                       { "event": "jump-to-timer-non-inherited-state", "nextState": "test-timer-non-inherited-state" },
                                       { "event": "jump-to-guarded-source-state", "nextState": "test-guarded-source-state" },
                                       { "event": "jump-to-guarded-target-state", "nextState": "test-guarded-target-state" },
                                       { "event": "jump-to-non-active-guarded-source-state", "nextState": "test-non-active-guarded-source-state" },
                                       { "event": "jump-to-target-function-state", "nextState": "test-target-function-state" }]
                        },
                        {
                           "name": "test-timer-inherited-state",
                           "timeout": { "from": ["test-started"], "duration": 6, "nextState": "test-timed-out-state" },
                           "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                        },
                        {
                           "name": "test-timer-non-inherited-state",
                           "timeout": { "duration": 5, "nextState": "test-timed-out-state" },
                           "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                        },
                        {
                           "name": "test-timed-out-state",
                           "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                        },
                        {
                           "name": "test-guarded-source-state",
                           "sources": [{ "guard": { "active": true, "property": "test-source-guard-prop" },
                                         "event": "go-through-source-guard", "nextState": "test-guarded-target-state" },
                                       { "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                        },
                        {
                           "name": "test-non-active-guarded-source-state",
                           "sources": [{ "guard": { "active": false, "property": "test-source-guard-prop" },
                                         "event": "go-through-source-guard", "nextState": "test-guarded-target-state" },
                                       { "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                        },
                        {
                           "name": "test-guarded-target-state",
                           "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" },
                                       { "event": "back-to-test-guarded-source-state", "nextState": "test-guarded-source-state" }],
                           "targets": [{ "guard": { "active": true, "property": "test-target-guard-prop", "value": true }, "property": "test-prop-3", "value": true },
                                       { "guard": { "active": true, "property": "test-target-guard-prop", "value": false }, "property": "test-prop-3", "value": false }]
                        },
                        {
                           "name": "test-target-function-state",
                           "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }],
                           "target": { "handler": "testTargetFunction" }
                        }
                     ]
                  }
               ],
               "things": []
            }
         ]
      }
   ]
}
