{
   "casa": {
      "uName": "casa:test-stateproperty",
      "displayName": "Casa Collin Test State Property",
      "gang": "gang:collin-test",
      "listeningPort": 8085
   },
   "services": [],
   "scenes": [],
   "things": [
      {
         "uName": "tester:stateproperty",
         "displayName": "Test property:stateproperty",
         "props": [],
         "targetUnderTest": "testthing:test-thing",
         "sources": [
            { "property": "test-state-1" },
            { "property": "test-action-guard-prop" },
            { "property": "test-prop-3" },
            { "event": "test-action-function-event" },
            { "event": "have-made-it-to-regex-matched-state-1" },
            { "event": "have-made-it-to-regex-matched-state-2" },
            { "event": "have-made-it-to-default-state" }
         ],
         "testRun": {
            "testCases": []
         },
         "testCases": [
            {
               "name": "1) Normal - Test basic transition on event and timeout based transition ",
               "driveSequence": [
                  { "event": "start-test" },
                  { "wait": 6, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "property": "test-state-1", "value": "test-started" },
                  { "property": "test-state-1", "value": "test-timed-out-state" },
                  { "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {
               "name": "2) Normal - Test basic transition on event and timeout based transition with intermediate inherited timer ",
               "driveSequence": [
                  { "event": "start-test" },
                  { "wait": 3, "event": "jump-to-timer-inherited-state" },
                  { "wait": 3, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "property": "test-state-1", "value": "test-started" },
                  { "property": "test-state-1", "value": "test-timer-inherited-state" },
                  { "property": "test-state-1", "value": "test-timed-out-state" },
                  { "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {
               "name": "3) Normal - Test basic transition on event and timeout based transition with intermediate non-inherited timer ",
               "driveSequence": [
                  { "event": "start-test" },
                  { "wait": 3, "event": "jump-to-timer-non-inherited-state" },
                  { "wait": 6, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "property": "test-state-1", "value": "test-started" },
                  { "property": "test-state-1", "value": "test-timer-non-inherited-state" },
                  { "property": "test-state-1", "value": "test-timed-out-state" },
                  { "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {
               "name": "4) Normal - Test basic transition with guard on source",
               "driveSequence": [
                  { "event": "start-test" },
                  { "wait": 0.5, "property": "test-prop-3", "value": true },
                  { "wait": 1, "event": "jump-to-guarded-source-state" },
                  { "wait": 1, "event": "go-through-source-guard" },
                  { "wait": 1, "property": "test-source-guard-prop", "value": true },
                  { "wait": 1, "property": "test-action-guard-prop", "value": true },
                  { "wait": 1, "property": "test-action-guard-prop", "value": false },
                  { "wait": 1, "property": "test-action-guard-prop", "value": true },
                  { "wait": 1, "property": "test-action-guard-prop", "value": false },
                  { "wait": 1, "property": "test-source-guard-prop", "value": false },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "property": "test-state-1", "value": "test-started" },
                  { "property": "test-prop-3", "value": true },
                  { "property": "test-state-1", "value": "test-guarded-source-state" },
                  { "simultaneous": [
                     { "property": "test-state-1", "value": "test-guarded-action-state" },
                     { "property": "test-prop-3", "value": false }
                  ]},
                  { "simultaneous": [
                     { "property": "test-prop-3", "value": true },
                     { "property": "test-action-guard-prop", "value": true }
                  ]},
                  { "simultaneous": [
                     { "property": "test-prop-3", "value": false },
                     { "property": "test-action-guard-prop", "value": false }
                  ]},
                  { "simultaneous": [
                     { "property": "test-prop-3", "value": true },
                     { "property": "test-action-guard-prop", "value": true }
                  ]},
                  { "simultaneous": [
                     { "property": "test-prop-3", "value": false },
                     { "property": "test-action-guard-prop", "value": false }
                  ]},
                  { "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {
               "name": "5) Normal - Test basic transition with active guard on action",
               "driveSequence": [
                  { "event": "start-test" },
                  { "wait": 1, "event": "jump-to-non-active-guarded-source-state" },
                  { "wait": 1, "event": "go-through-source-guard" },
                  { "wait": 1, "property": "test-source-guard-prop", "value": true },
                  { "wait": 1, "event": "go-through-source-guard" },
                  { "wait": 1, "property": "test-action-guard-prop", "value": false },
                  { "wait": 1, "property": "test-source-guard-prop", "value": false },
                  { "wait": 1, "property": "test-action-guard-prop", "value": true },
                  { "wait": 1, "property": "test-action-guard-prop", "value": false },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "property": "test-state-1", "value": "test-started" },
                  { "property": "test-state-1", "value": "test-non-active-guarded-source-state" },
                  { "property": "test-state-1", "value": "test-guarded-action-state" },
                  { "property": "test-action-guard-prop", "value": true },
                  { "property": "test-prop-3", "value": true },
                  { "property": "test-action-guard-prop", "value": false },
                  { "property": "test-prop-3", "value": false },
                  { "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {  
               "name": "6) Normal - Test basic transition with non-active guard on source",
               "driveSequence": [
                  { "event": "start-test" },
                  { "wait": 1, "event": "jump-to-non-active-guarded-source-state" },
                  { "wait": 1, "event": "go-through-source-guard" },
                  { "wait": 1, "property": "test-source-guard-prop", "value": true },
                  { "wait": 1, "property": "test-source-guard-prop", "value": false },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "property": "test-state-1", "value": "test-started" },
                  { "property": "test-state-1", "value": "test-non-active-guarded-source-state" },
                  { "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {  
               "name": "7) Normal - Test action function",
               "driveSequence": [
                  { "event": "start-test" },
                  { "wait": 1, "event": "jump-to-action-function-state" },
                  { "wait": 1, "property": "test-prop-3", "value": false },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "property": "test-state-1", "value": "test-started" },
                  { "property": "test-prop-3", "value": true, "fuzz": 1 },
                  { "property": "test-state-1", "value": "test-action-function-state" },
                  { "event": "test-action-function-event", "value": true },
                  { "property": "test-prop-3", "value": false },
                  { "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {  
               "name": "8) Normal - Test RegEx state matching",
               "driveSequence": [
                  { "event": "start-test" },
                  { "wait": 1, "event": "jump-to-regex-matched-state-1" },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "property": "test-state-1", "value": "test-started" },
                  { "property": "test-state-1", "value": "matchthistatethroughregex" },
                  { "event": "have-made-it-to-regex-matched-state-1", "value": true },
                  { "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {  
               "name": "9) Normal - Test RegEx state matching",
               "driveSequence": [
                  { "event": "start-test" },
                  { "wait": 1, "event": "jump-to-regex-matched-state-2" },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "property": "test-state-1", "value": "test-started" },
                  { "property": "test-state-1", "value": "sjdhjshd09098448574674873873" },
                  { "event": "have-made-it-to-regex-matched-state-2", "value": true },
                  { "property": "test-state-1", "value": "test-idle-state" }
               ]
            },
            {  
               "name": "10) Normal - Test RegEx state matching",
               "driveSequence": [
                  { "event": "start-test" },
                  { "wait": 1, "event": "jump-to-regex-matched-state-3" },
                  { "wait": 1, "event": "reset-back-to-idle" }
               ],
               "expectedSequence": [
                  { "property": "test-state-1", "value": "test-started" },
                  { "property": "test-state-1", "value": "matchthista%tethroughregex097634GHGNj" },
                  { "event": "have-made-it-to-default-state", "value": true },
                  { "property": "test-state-1", "value": "test-idle-state" }
               ]
            }
         ],
         "things": [
         ]
      },
      {
         "uName": "testthing:test-thing",
         "displayName": "Test thing",
         "events": [],
         "props": [
            {
               "name": "test-prop-1",
               "initialValue": false
            },
            {
               "name": "test-prop-2",
               "initialValue": false
            },
            {
               "name": "test-prop-3",
               "initialValue": false
            },
            {
               "name": "test-source-guard-prop",
               "initialValue": false
            },
            {
               "name": "test-action-guard-prop",
               "initialValue": false
            },
            {
               "name": "test-state-1",
               "type": "stateproperty",
               "initialValue": "test-idle-state",
               "states": [
                  {
                     "name": "test-idle-state",
                     "sources": [{ "event": "start-test", "nextState": "test-started" }]
                  },
                  {
                     "name": "test-started",
                     "timeout": { "duration": 5, "nextState": "test-timed-out-state" },
                     "sources": [{ "event": "jump-to-timer-inherited-state", "nextState": "test-timer-inherited-state" },
                                 { "event": "jump-to-timer-non-inherited-state", "nextState": "test-timer-non-inherited-state" },
                                 { "event": "jump-to-guarded-source-state", "nextState": "test-guarded-source-state" },
                                 { "event": "jump-to-guarded-action-state", "nextState": "test-guarded-action-state" },
                                 { "event": "jump-to-non-active-guarded-source-state", "nextState": "test-non-active-guarded-source-state" },
                                 { "event": "jump-to-action-function-state", "nextState": "test-action-function-state" },
                                 { "event": "jump-to-regex-matched-state-1", "nextState": "matchthistatethroughregex" },
                                 { "event": "jump-to-regex-matched-state-2", "nextState": "sjdhjshd09098448574674873873" },
                                 { "event": "jump-to-regex-matched-state-3", "nextState": "matchthista%tethroughregex097634GHGNj" }]
                  },
                  {
                     "name": "test-timer-inherited-state",
                     "timeout": { "from": ["test-started"], "duration": 6, "nextState": "test-timed-out-state" },
                     "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                  },
                  {
                     "name": "test-timer-non-inherited-state",
                     "timeout": { "duration": 5, "nextState": "test-timed-out-state" },
                     "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                  },
                  {
                     "name": "test-timed-out-state",
                     "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                  },
                  {
                     "name": "test-guarded-source-state",
                     "sources": [{ "guard": { "active": true, "property": "test-source-guard-prop" },
                                   "event": "go-through-source-guard", "nextState": "test-guarded-action-state" },
                                 { "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                  },
                  {
                     "name": "test-non-active-guarded-source-state",
                     "sources": [{ "guard": { "active": false, "property": "test-source-guard-prop" },
                                   "event": "go-through-source-guard", "nextState": "test-guarded-action-state" },
                                 { "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                  },
                  {
                     "name": "test-guarded-action-state",
                     "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" },
                                 { "event": "back-to-test-guarded-source-state", "nextState": "test-guarded-source-state" }],
                     "actions": [{ "guard": { "active": true, "property": "test-action-guard-prop", "value": true }, "property": "test-prop-3", "value": true },
                                 { "guard": { "active": true, "property": "test-action-guard-prop", "value": false }, "property": "test-prop-3", "value": false }]
                  },
                  {
                     "name": "test-action-function-state",
                     "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }],
                     "action": { "handler": "testActionFunction" }
                  },
                  {
                     "name": "test-regex-matched-state-1",
                     "regEx": "^[A-Za-z]+$",
                     "action": { "event": "have-made-it-to-regex-matched-state-1", "value": true },
                     "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                  },
                  {
                     "name": "test-regex-matched-state-2",
                     "regEx": "^[A-Z-a-z0-9]+$",
                     "action": { "event": "have-made-it-to-regex-matched-state-2", "value": true },
                     "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                  },
                  {
                     "name": "DEFAULT",
                     "action": { "event": "have-made-it-to-default-state", "value": true },
                     "sources": [{ "event": "reset-back-to-idle", "nextState": "test-idle-state" }]
                  }
               ]
            }
         ],
         "things": []
      }
   ]
}
